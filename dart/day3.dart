String input =
    '.........232.633.......................803..........................361................192............539.................973.221...340.....\n.............*..............#.....256.#.........329....................*313............*.......766.......*..........472..-...........+..249.\n670-..@.......181......814..865.........968......@.......605....128.............%......798.638...+....776...........*......%...........*....\n.......563........741....*..........&.....-...............*........*....815*....921...........*..............428.219..993.584...990.431.....\n.........................466.971..815...&....634.197.%...887....114.........521.........&..796.......-.......+..........*......*............\n................713.546......*........941......*..*..837............903...............910.........988....61..........&..946..240......697...\n........563........*....707-..895...........223..160......618..........*..................................&...61...603............495.=.....\n..........\$............................+633............................697.910.....@70..................................497......*..........\n...568..........+832......@.......551............#863...324*......................................837......701..740.................72......\n.....*.98..................245....#.........&...............145................#...832.......580.....*.......\$../.....432..........*........\n..315....../......4.......................174......*971............76.......472..............*.......66...................260.....348.......\n.......179.908.....%.......-....-108.726........654......422.................................501.644....279.....&.....528*..................\n........*.................913..........*.639*............-...........-131..5.....%......................*.......228.........900..148........\n......665..........220.......................561...........................*...237..576.381.........../.......................*.............\n771................*.................416.................996.799........441..........*..=..........355...........570.481*422..798...........\n....+924..#462..420..659@.404.........#...................*..*......*..........233.........................955...%..........................\n..........................................265.........86..43..1.398..624......*........896.53.855............/........301...............#...\n...............688.................#..614*..............*........#............103.486...@....*....+........................672.725....508...\n...........993...=.....906.124....92.............208@.626...298.....................*..........810........428*461..619........*.............\n590*......*........636..*..*...........683..................@.....*128...524...../...507..@636........................=...........991.....52\n....61.993............*....627...=796..*.......................841..........#....105...........313......=...................555...#.........\n715........625..963.194.................505..841......&442.............108*....................=.........58.......450..........*............\n............*....*..........343.138*560.......-............................561..........*53.................\$........#.327......766....234..\n.....-...276....370..........%............913..................16.825.............%..111.....561..........446...............................\n.....372...............................@............@..........././....*8.......136......758....&..349.................666.....*............\n.........340..639............214......364..31&.......440..644\$......577....................&......*.....................#...382.............\n........*.......................*..........................................175..........84........931..692.......................*..........\n.......860..........@..........400............235.....797.................*...............*...863................683/....778..367.79........\n..................192.....%...........897..............*.....320*634......................32..............556...........................\$...\n...........783...........475.............*.781......875..891...........867......322...............8..........*...938..318.462*........&..620\n....#.......*....\$293.................330.....*............*...........*.....26*.......668.205.......32.%....975.....#........750...25......\n..521......388.........116.....33.............2...........519..717..859..............&....*....*881.*...109...............828...............\n................................*...927.........................*.....................240....66.....27.......482.227*...................#968\n...\$479...........91*...%.......598........102../.........615.....184..@......456.385....................+.....*.....476...13+...391........\n........................526..................+...90..............*....500.......\$....*.....14......*......206.57............................\n.........53&...134*...........%784....=................775.692.88..........873......115..9.*....937.242..................729...342......344.\n....*568.....#.....................-..140...=.............*..................*..............521................185......*......*............\n.462..........331...\$......337...90........829.....\$.........262=.....376..787.........*352...................*..........227..413....518....\n......&............796.698...@.................346..277....=.........*............%.918......902.....327.....120....320...............*.....\n....902.....488..%...............................*........150.688...822.........721...........*......................*.............*3.445...\n...........*....132...........71..880.........770.....150..................................674.............924........746.......403.........\n.....929...771..................*..................\$.....*..110....63..................847.............423...-....651.......................\n................./......729...927..867..........577...763...*........*..55.....320*......../..674.962..............*.............421........\n.../...........707.........*...........222.................301....702....*.........943...431..+....#....59.600..756...593..352..=......*579.\n.965...607............669.406.704........*..............#......*......720.................................*..........@.......@..............\n...........333.........*......*..........839.............449...210.........219........=84...842.............................................\n.......582...-..........350.831..394.835.....184...........................*.....676........*............755.........22.....................\n..710.....&............................#........+.....................86.889..............86..625..........*...........*......195.547.......\n......549....945.601.........*.......+......975..............285.................743.........*............433..........619..........*....675\n.........+.............204..161.......493..*.......896...576..*........328...............902.819....362..........373..............854..-....\n.......................*..........272.......812....../..*.....933..447.....950...124.....*.............*....990....+..\$172....139.......530.\n27...\$....844.486.....810.826........+...................880.......=........=...*.....359....242#..432..206....................*............\n.....519...+....*.........&.....................805..66.......................@.......................*.........859.........943.............\n742............116..........*421..-984.......=...*..#....+...559....*566...790........\$......372.307...180.....*...................532......\n...*.....................135................88.417....576......+......................138......*....-.......314........776...........*......\n.670..................................893.........................565..985......833..........369..=....#372........842......868...221.......\n.......168..128....500..........962..*....31........143.....897*..@...*..............727..........42.........................*........24-...\n..382.*.....*..................*....593................................414..165...........................179+..42....\$.=.......=...........\n....*..468..362......39.........802....................339.................*..................240............../...257...386.262..556.......\n...852..............*....670...............872........../.........480.....945..983*604....997*..........182......................*..........\n.........916.....800...*..*........#......*.......165...............#..........................%....927...*.....................55.....#....\n.........*............521.394.......142...672.967..........107...........785.208.....-...&....614....@...386.975...................923..273.\n...146..70....................................*....177....*........550......*.....606...430....................*....35......=.........*.....\n.....*.....=..707..157*334......675*....=..719......*.....762.....+.....960.................................343....*.......498.........291..\n..654....592.....*..................54.500...........772.................*.....................252....689...........357........778.273......\n..............455....\$.........381*...........*117................388.386...........258/......*...................*..............*....*.....\n.....................948...........914.....514.......476........../........975................274.....119.....-.56.94.....390...250.484.....\n......723........................................415....*451................*...2.......................*...115..............-..............\n..818*.................859.401*240...205...228...................757.102...954......#.............863.523...................................\n.........613.844.832..................*...-..................35.......*............989.....+........*.........381..............827.702......\n..........*....*...................592.............=456.....*...@.385...78..................233.....27...............49.574.....*.....=.....\n........230.311...326...617..585.........................798..699.%....=.....20........................687.....662.......*......246.........\n735..61..........*......*.....*.............361....................................=...................%........*.....171...380........786..\n.......*..%......378.624.........836*742...=...../...#...322......../...195.......634.....422..893*106.....-.....960.........*.....121*.....\n....969....738...............%..................919.78........685.773......*..............................654..=...........414..............\n...........................297...............=.........44.718...............718....841...446.....881+.../......825.870.........104..341.....\n.............663.292.............165....466...892.........@..........296..................*..............948.......*................*.......\n..748....*..........................\$...*.........99...........707.....&.339...............483...............*....896.......&.....241.......\n...*..=...494....@..227.@821.............761.......*.............-.143...*......329...............24.......54.........202..588..............\n.481..203......37...............90..390........171..80...................857...\$..........689+...+......=.......930...*.....................\n............#......*794..........*.*...........@..........233*503......................................62......%....%.14....*...........+...\n..438%....149...492...........842.......721..........................301.....................958../...............265....628.9.......813....\n.........................671*.....518......*.........903*974..120.....*..269...560....907....*...214............\$........................961\n.............................22......*....740..................&.....825....*.*..../....+...612..................740..........307...467.....\n...............350......535.........665........138...........#....\$......831..487..432...................................348..*.......*.....\n....32........................529.................*395......318...984...................492....*..........835...............\$.735..333......\n....=.....136.................*.......................................&....779.848..*..*....486.......736....*..............................\n..........\$......507..329.....189..............................745.....223.%.....*.552..888........+....*....53........415..................\n.....................=...................+..930....845..3..\$..../...99........599................731.986..............-.......582....669....\n.367*969.........../.........132........13..*.....*.......420......@......442.........793.....................................*.....@.......\n..............997.908.148......+...........961.397....................9.......................144...736\$...942.346.....970..72..........*794\n..608.13..993.+........\$...........462...............539..560....637..#......208....896...5......*.......@...*..*..856*..............178....\n....*...\$./................727..................787..=.....*.....*......593....*.....+...........736...191.609.774.................*........\n.....62.......325*.....372....*994../...........-..........513.853.907.........43...........*........................511-.850.......49..696.\n..........856.....651....*.........314...213..........+.............*..............%.....718.70...................*..........*.........=....\n....659*...*..........453..............................123.........921.......11=..32...............312....795..467.689.......760............\n............997................545.597.................................@.................\$........*.........*...........................808.\n..565...............115.522.....*...........-..179...606.269.........885...733*.........857.857.252....510.842...518.......678........\$.....\n....%..............*.....*.......420.426..92.....*......*......................447..........*............*...........995.....*.761.158......\n.......128.......178..495......%........*.......748.......927.411..........519..............430.......&..480...........*..667...*......+....\n.........*....................266..-846.625.807.......561*.........687.....*...*268....55=....../....60............%.556.......56......67...\n.........698..593+..485.......................*....................%......166..................174..............944.......591.....808.......\n.....698...........*....376......891...........951.............538.............563....472..........584*460...\$............=.............492.\n....*...........716....*.........=.....238.297....................*........23*...*....*.....90..............668.............%...............\n...798.351....*.......720.513...............*....476..............312.&745....35..550.885...........343.........937.........435.........\$...\n..........*....882.........#..............556....../..417...691...............................671......*...609...-.....424......*675.....650\n....9....900........*........867......................\$....*..........975&..@.......897........\$......905.....*.......\$......122............\n.....&.......*...555.796....@...............&.............530..............229..............................585...................22........\n.......456.495.....................107...800............-.....683........................876......=....181*..............954.....\$..........\n...774*..............643......437.....&..............310....-...&..............494*..265....%....320...............*.......*................\n........*13...........*..........\$........................258................/.......*..................632.....677.227.922........#........\n.....778..............384....908........156%....533..............192..420.....861.771..=........553...........................860..370...309\n.............483..................................................*...................500..773....@.......900....................*......@...\n........249.%...............93*..................171...248...315...470..........169..................*198...*...........482.......771.......\n...267...*.....835/............6....459..252........&...*......*...............*......=.....496*..334.....493..............*................\n..........991...........191.........*........521/........661..514...............832....296....................\$.650.....363......442........\n.....942...............*............58.................................390.....................\$............865...-.........................\n..16*.........586...993....%..............255...55..........337...............334..............82..+....&..............490-..........5.381..\n.................*..........16.867...........*.&...35/.........*.427...........#..................877.768.......+.......................@...\n................110...413#........*104.....90..........623..433....=..*..462...........33.685.228................288.........513...721*.....\n........717.................#.344........................*...........970.................*.......#...953....546........162.............637..\n........*.................37...*.......740......331......564.....................556.................*.....*....843.......*.................\n..195............2*...........937......*.......-.......*..........=..255.349.....=.......*837.......342....411.*.......537...337.....791....\n........=..........641...............424.............24..........261....*.............667.....551&.............324..........%..........*....\n..330...841./465.......486......................&.......*996.........#..................................227...........&.........33.681..354.\n....@..................\$........................455..........304.....542.#....64..624........./........*........716...245...166...*.........\n..........331*738...............249.................126..833...*..........913.................690....943..284..................*........938.\n.................................@....224...429....*......*.....195..................231..................*....857.............975..........\n............252..........71.599...................279...828............&......&.......+.................967...*............285.........798..\n.370.....&...*.............*.........640.............................898...746..134...........\$.329.........768....279+.....=...840....*....\n...*...979.374..192..............370*..............964...970....................*..........436...*....410........................*....306...\n..................*.727...139*...........................-....689..819..498....982.....131.....566........................390....505........\n....................*.........84...973.......830..394.........*.........*...............*..........401.562..907.....405......\$.......321....\n....#....455..*.....284............../.......*......-.722..124.......&...921...........303............./.......*652.....-........*....*.....\n.286.....*...775../.......274/....74...774.986.................96.469.......................335..526..................344..31.942.31...846..\n..........72.......582...................*..............#......*..........380&........570....../....*.........\$....*........*...............\n......................................201....*648......838..253....101*.@................/..........606.....744..792.........396..-990..+609\n.938...............*..896..125*...........842...........................485...510............801.....................329.983................\n...*............963....*.......761..............................................*...927.........*...................*.....*........45.......\n....981................675.........676.............156.............30...........998............697......14..366....960...874..497........278';

List<String> findAllDigits(String input) {
  RegExp regex = RegExp(r'\d+');
  Iterable<RegExpMatch> matches = regex.allMatches(input);

  return matches.map((match) => match.group(0)!).toList();
}

bool isSymbol(String input) {
  RegExp regex = RegExp(r'\d+');
  bool isNumber = regex.hasMatch(input);

  bool isPeriod = input == '.';

  return !isNumber && !isPeriod;
}

void puzzle1() {
  int sum = 0;

  List<String> lines = input.split('\n');
  int lineLength = lines.first.length;

  for (int i = 0; i < lines.length; i++) {
    if (lines[i].length != lineLength) {
      throw Exception('line is not uniform length');
    }
    String? aboveLine = i != 0 ? lines[i - 1] : null;
    String? belowLine = i != lines.length - 1 ? lines[i + 1] : null;

    List<String> digitsInString = findAllDigits(lines[i]);
    int checkedIndex = 0;
    for (String digit in digitsInString) {
      int startIndex = lines[i].indexOf(digit);
      if (startIndex < checkedIndex) {
        startIndex = lines[i].lastIndexOf(digit);
      }
      checkedIndex = startIndex;
      int endIndex = startIndex + digit.length - 1;

      // see if digit is adjacent to a symbol
      // if so, add to sum
      // else, ignore

      // left
      if (startIndex != 0) {
        if (isSymbol(lines[i][startIndex - 1])) {
          sum += int.parse(digit);
          print('$digit has a symbol to the LEFT of it');
          continue;
        }
      }

      // right
      if (endIndex != lineLength - 1) {
        if (isSymbol(lines[i][endIndex + 1])) {
          sum += int.parse(digit);
          print('$digit has a symbol to the RIGHT of it');
          continue;
        }
      }

      // above
      if (aboveLine != null) {
        // above left diagonal
        if (startIndex != 0) {
          if (isSymbol(aboveLine[startIndex - 1])) {
            sum += int.parse(digit);
            print('$digit has a symbol to the ABOVE LEFT DIAGONAL of it');
            continue;
          }
        }

        // above right diagonal
        if (endIndex != lineLength - 1) {
          if (isSymbol(aboveLine[endIndex + 1])) {
            sum += int.parse(digit);
            print('$digit has a symbol to the ABOVE RIGHT DIAGONAL of it');
            continue;
          }
        }

        // check straight above values
        bool hasAbove = false;
        for (int n = startIndex; n <= endIndex; n++) {
          if (isSymbol(aboveLine[n])) {
            sum += int.parse(digit);
            print('$digit has a symbol to the ABOVE of it');
            hasAbove = true;
            break;
          }
        }
        if (hasAbove) continue;
      }

      // below
      if (belowLine != null) {
        // below left diagonal
        if (startIndex != 0) {
          if (isSymbol(belowLine[startIndex - 1])) {
            sum += int.parse(digit);
            print('$digit has a symbol to the BELOW LEFT DIAGONAL of it');
            continue;
          }
        }

        // below right diagonal
        if (endIndex != lineLength - 1) {
          if (isSymbol(belowLine[endIndex + 1])) {
            sum += int.parse(digit);
            print('$digit has a symbol to the BELOW RIGHT DIAGONAL of it');
            continue;
          }
        }

        // check straight above values
        bool hasBelow = false;
        for (int n = startIndex; n <= endIndex; n++) {
          if (isSymbol(belowLine[n])) {
            sum += int.parse(digit);
            print('$digit has a symbol to the BELOW of it');
            hasBelow = true;
            break;
          }
        }
        if (hasBelow) continue;
      }
    }
  }

  print(sum);
  return;
}

void main() {
  puzzle1();
  return;
}
